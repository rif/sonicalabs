{{left_sidebar_enabled,right_sidebar_enabled=False,True}}
{{extend 'layout.html'}}

<h1>{{=T('Upload a file')}}</h1>
{{=form}}

<a href="{{=URL('index')}}">{{=T('Back')}}</a>

{{block right_sidebar}}
{{=A(T("Record"), _href=URL('record'), _class='button', _style='margin-top: 1em;')}}
{{end}}

<link href="{{=URL('static','css/chosen.css')}}" rel="stylesheet" type="text/css" />
<script src="{{=URL('static','js/chosen.jquery.min.js')}}" type="text/javascript"></script>

<script type="text/javascript">
$("#sounds_language").chosen();
function uploadFiles(url, files) {  
  var formData = new FormData();

  formData.append("uuid", $("#sounds_download_uuid").val());
  for (var i = 0, file; file = files[i]; ++i) {    
    formData.append("upload", file);
  }  
  $.ajax({  
    url: url, type: "POST", data: formData, processData: false, contentType: false,
    success: function (res) {  
        console.log("done!"); 
        $('form').unbind("submit");
        $('form').submit();
    }  
  }); 
}

$(function(){
  $("#sounds_download_uuid__row").hide();
	$('form').submit(function(){
		//uploadFiles('http://localhost:6060/process', $('input[type="file"]')[0].files);
    uploadFiles('http://avocadosoft.ro:6060/process', $('input[type="file"]')[0].files);
    return false;
	});	
});
</script>